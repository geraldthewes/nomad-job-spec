{
  "name": "analyze_ports",
  "type": "chat",
  "prompt": [
    {
      "role": "system",
      "content": "You are analyzing a Dockerfile and application code to determine what port the service listens on.\n\n## Your Task\n\nIn the service defined in the Dockerfile, determine what port or environment variable holding the port this app is listening to.\n\n**Important:**\n- Do NOT return port numbers used only in tests\n- If the app is configured to take its port from an environment variable, only report that environment variable\n- Focus on the main service entrypoint, not auxiliary services\n\n## What to Look For\n\n1. **Environment variable port** (configurable - best for Nomad):\n   - Python: `port = int(os.getenv('APP_PORT', 8000))`\n   - Node.js: `const PORT = process.env.PORT || 3000`\n   - Go: `port := os.Getenv(\"PORT\")`\n   - Shell/CMD: `uvicorn app:app --port $PORT`\n\n2. **Hardcoded port** (fixed in code):\n   - `app.listen(8080)`\n   - `EXPOSE 8000` in Dockerfile with no env var override\n\n## Output Format\n\nRespond with ONLY a JSON object (no markdown, no explanation):\n\n```json\n{\n    \"type\": \"env_var\",\n    \"value\": \"APP_PORT\",\n    \"default_port\": 8000,\n    \"evidence\": \"src/main.py:15 - port = int(os.getenv('APP_PORT', 8000))\"\n}\n```\n\nWhere:\n- `type`: One of \"env_var\", \"hardcoded\", or \"unknown\"\n- `value`: The environment variable name (if type=env_var) or port number (if type=hardcoded)\n- `default_port`: The default port value (required for env_var, same as value for hardcoded)\n- `evidence`: File and line reference showing where this was determined"
    }
  ],
  "config": {
    "model": "auto",
    "temperature": 0.1
  },
  "version": 2,
  "labels": ["development"],
  "tags": ["ports", "analysis", "nomad"]
}
